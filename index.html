<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Redundancy Removal System</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <script type="module">
        // Removed Firebase SDK imports for local storage implementation

        // Define constants for local storage key and a mock user ID
        const LOCAL_STORAGE_KEY = 'DRRS_UNIQUE_DATA';
        const MOCK_USER_ID = 'local-storage-user-123';
        let currentUserId = MOCK_USER_ID; // Initialize user ID

        // --- Core Application State & Refs ---
        const statusLog = document.getElementById('status-log');
        const uniqueDataList = document.getElementById('unique-data-list');
        const dataInput = document.getElementById('data-input');
        const sourceInput = document.getElementById('source-input');
        const checkButton = document.getElementById('check-button');
        const userIdDisplay = document.getElementById('user-id-display');

        /**
         * Utility function to log status messages to the UI.
         * @param {string} message - The message to display.
         * @param {string} type - 'success', 'error', 'info', or 'warning'.
         */
        const logStatus = (message, type = 'info') => {
            const time = new Date().toLocaleTimeString();
            let colorClass;
            switch (type) {
                case 'success': colorClass = 'text-green-600 bg-green-50'; break;
                case 'error': colorClass = 'text-red-600 bg-red-50'; break;
                case 'warning': colorClass = 'text-yellow-600 bg-yellow-50'; break;
                case 'info':
                default: colorClass = 'text-blue-600 bg-blue-50'; break;
            }

            const logEntry = document.createElement('div');
            logEntry.className = `p-2 my-1 text-sm rounded-lg ${colorClass}`;
            logEntry.innerHTML = `<strong>[${time} - ${type.toUpperCase()}]</strong>: ${message}`;
            
            // Prepend new logs so they appear at the top
            if (statusLog.firstChild) {
                statusLog.insertBefore(logEntry, statusLog.firstChild);
            } else {
                statusLog.appendChild(logEntry);
            }
            // Limit log entries to 10 for performance
            while (statusLog.childElementCount > 10) {
                statusLog.removeChild(statusLog.lastChild);
            }
        };
        
        /**
         * Retrieves the data array from localStorage.
         * @returns {Array} The array of unique data entries.
         */
        const getLocalData = () => {
            const dataString = localStorage.getItem(LOCAL_STORAGE_KEY);
            try {
                return dataString ? JSON.parse(dataString) : [];
            } catch (e) {
                console.error("Error parsing localStorage data:", e);
                logStatus('Error retrieving data from local storage. Data may be corrupted.', 'error');
                return [];
            }
        };

        /**
         * Initializes the application, setting up the UI and loading data.
         */
        const initializeApp = () => {
            userIdDisplay.textContent = `User ID: ${currentUserId} (Local Storage)`;
            logStatus('Initialization complete. Using Local Storage for data persistence.', 'success');
            checkButton.disabled = false;
            loadUniqueDataFromLocal();
        };

        /**
         * Loads and displays unique data from localStorage. (Replaces Firebase setupRealtimeListener)
         */
        const loadUniqueDataFromLocal = () => {
            const uniqueData = getLocalData();
            uniqueDataList.innerHTML = '';
            
            logStatus(`Fetched ${uniqueData.length} unique records from local storage.`, 'info');
            
            if (uniqueData.length === 0) {
                uniqueDataList.innerHTML = '<p class="text-gray-500 italic p-4">No unique data entries found yet.</p>';
                return;
            }

            // Display latest entries first
            // Note: Data is sorted by timestamp created at the time of entry
            const sortedDocs = [...uniqueData].sort((a, b) => b.timestamp.localeCompare(a.timestamp));

            sortedDocs.forEach((data) => {
                const entry = document.createElement('li');
                entry.className = 'p-3 mb-2 bg-white rounded-lg shadow-sm border border-gray-100 flex justify-between items-center';
                
                // Use the last 8 characters of the ISO timestamp for a pseudo-ID reference
                const uniqueId = data.timestamp ? data.timestamp.substring(data.timestamp.length - 8) : 'N/A'; 

                const textContent = `<div class="flex-grow">
                    <p class="font-mono text-sm text-gray-800">${data.value}</p>
                    <p class="text-xs text-gray-500">Source: ${data.source} | ID: ${uniqueId}</p>
                </div>`;

                entry.innerHTML = textContent;
                uniqueDataList.appendChild(entry);
            });
        };

        /**
         * Checks if the new data is redundant and, if not, adds it to localStorage. (Replaces Firebase checkAndAddData)
         */
        const checkAndAddData = async () => {
            const newValue = dataInput.value.trim();
            const newSource = sourceInput.value.trim() || 'Manual Entry';

            if (!newValue) {
                logStatus('Data entry cannot be empty.', 'error');
                return;
            }

            checkButton.disabled = true;
            checkButton.textContent = 'Checking...';

            // 1. Basic Data Quality Check (Simplified False Positive/Review Simulation)
            if (newValue.length < 5) {
                logStatus(`Data entry "${newValue}" is very short (length < 5). Potential False Positive or low-quality data flagged for review.`, 'warning');
            }
            
            try {
                const existingData = getLocalData();
                
                // 2. Redundancy Check: Check if the value already exists in the local array
                // This is the core validation mechanism.
                const isRedundant = existingData.some(entry => entry.value === newValue);

                if (isRedundant) {
                    // 3. Classification: REDUNDANT
                    logStatus(`REDUNDANT: Data already exists in local storage. Entry blocked.`, 'error');
                } else {
                    // 4. Classification: UNIQUE and VERIFIED 
                    
                    // 5. Append Unique Entry to Local Storage
                    const newDoc = {
                        value: newValue,
                        source: newSource,
                        timestamp: new Date().toISOString(),
                        verified_by_user: currentUserId
                    };

                    existingData.push(newDoc);
                    localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(existingData));
                    
                    logStatus(`UNIQUE & VERIFIED: New entry added successfully to local storage.`, 'success');
                    dataInput.value = ''; // Clear input on success
                    sourceInput.value = '';
                    
                    // Manually refresh the list as local storage doesn't have real-time listeners
                    loadUniqueDataFromLocal();
                }
            } catch (error) {
                console.error("Data Check/Add Error:", error);
                logStatus(`Local Storage Operation Failed: ${error.message}`, 'error');
            } finally {
                checkButton.disabled = false;
                checkButton.textContent = 'Check & Append Data';
            }
        };

        // --- Event Listeners and Initialization ---
        window.onload = initializeApp;
        checkButton.addEventListener('click', checkAndAddData);

        // Export functions/vars needed in the global scope if any, for example debugging
        window.logStatus = logStatus;

    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
        }
        .container-shadow {
            box-shadow: 0 15px 30px -5px rgba(100, 100, 100, 0.1), 0 8px 16px -8px rgba(100, 100, 100, 0.1);
        }
        /* Custom scrollbar for log area */
        #status-log {
            max-height: 250px;
            overflow-y: auto;
            display: flex;
            flex-direction: column-reverse; /* New entries appear at the top */
        }
        #status-log::-webkit-scrollbar {
            width: 8px;
        }
        #status-log::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-6xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Data Redundancy Removal System (DRRS)</h1>
            <p class="text-lg text-gray-600 mt-2">Validate, Classify, and Ensure Data Accuracy Locally</p>
            <p id="user-id-display" class="mt-2 text-sm text-gray-400">User ID: Connecting...</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- Input & Validation Panel (Col 1/3) -->
            <div class="lg:col-span-1 bg-white p-6 rounded-xl container-shadow border border-blue-100 h-fit">
                <h2 class="text-xl font-semibold mb-4 text-blue-600 border-b pb-2">New Data Validation</h2>
                <p class="text-sm text-gray-500 mb-4">Enter a data string and a source to check against the existing local storage data. Exact duplicates will be prevented.</p>
                
                <div class="mb-4">
                    <label for="data-input" class="block text-sm font-medium text-gray-700 mb-1">Data Entry Value</label>
                    <input type="text" id="data-input" placeholder="e.g., Transaction-ID-9901-XYZ" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" required>
                </div>
                
                <div class="mb-6">
                    <label for="source-input" class="block text-sm font-medium text-gray-700 mb-1">Data Source (Optional)</label>
                    <input type="text" id="source-input" placeholder="e.g., API-Batch-3" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                </div>

                <button id="check-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-xl transition duration-300 disabled:bg-gray-400" disabled>
                    Check & Append Data
                </button>
            </div>

            <!-- Validation Log (Col 2/3) -->
            <div class="lg:col-span-1 bg-white p-6 rounded-xl container-shadow border border-red-100 h-fit">
                <h2 class="text-xl font-semibold mb-4 text-red-600 border-b pb-2">Redundancy & Status Log</h2>
                <p class="text-sm text-gray-500 mb-4">System messages indicating classification (Redundant, Unique, False Positive) and data actions in local storage.</p>
                <div id="status-log" class="bg-gray-50 p-2 rounded-lg border border-gray-200">
                    <!-- Log entries appear here -->
                    <div class="p-2 my-1 text-sm rounded-lg text-blue-600 bg-blue-50">
                        <strong>[INITIALIZING]</strong>: Connecting to local storage...
                    </div>
                </div>
            </div>

            <!-- Existing Data Panel (Col 3/3) -->
            <div class="lg:col-span-1 bg-white p-6 rounded-xl container-shadow border border-green-100">
                <h2 class="text-xl font-semibold mb-4 text-green-600 border-b pb-2">Unique Verified Data Entries</h2>
                <p class="text-sm text-gray-500 mb-4">The current list of unique and verified data entries stored in the browser's local storage.</p>
                <ul id="unique-data-list" class="space-y-3">
                    <li class="p-3 mb-2 bg-white rounded-lg shadow-sm border border-gray-100 flex justify-between items-center">
                        <p class="text-gray-500 italic">Loading data...</p>
                    </li>
                </ul>
            </div>

        </main>
    </div>

</body>
</html>
